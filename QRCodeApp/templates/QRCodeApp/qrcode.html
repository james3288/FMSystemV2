{% extends 'base/base.html' %}
{% load static %}

{% block title %}
<title>FMS - QR Code</title>
{% endblock %}


{% block content %}
<section class="section">
    <div class="row">
      <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
              <h5 class="card-title">QR CODE SCANNER</h5>
              <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>
              <!-- Basic Modal -->
              <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#basicModal">
                Scan Now
              </button>
              <div class="modal fade" id="basicModal" tabindex="-1" aria-hidden="true" style="display: none;">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">Adfil QR Code Scanner</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <h5 class="card-title">Scan Result:</h5>
                        <p id="resultID">Toggle a working modal demo by clicking the button below. It will slide down and fade in from the top of the page</p>
                        <div id="my-qr-reader">

                        </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                      <button type="button" class="btn btn-primary">Generate Data</button>
                    </div>
                  </div>
                </div>
              </div><!-- End Basic Modal-->

            </div>
        </div>
      </div>
    </div>
</section>

<!-- LOAD LIBRARY -->
<script src="https://unpkg.com/html5-qrcode"></script>
<script>
    function domReady(fn){
        if(document.readyState === 'complete' || document.readyState === 'interactive'){
            setTimeout(fn,1)
        }else{
            document.addEventListener("DOMContentLoaded",fn)
        }
    }
    
    domReady(function(){
        var myqr = document.getElementById('resultID')
        var lastResult,countResults = 0;

        // IF FOUND YOUR QR CODE
        function onScanSuccess(decodeText,decodeResult){
            if(decodeText !== lastResult){
                ++countResults;
                lastResult = decodeText;

                // alert("Your Qr is: "+ decodeText,decodeResult)
                //
                myqr.innerHTML = `you scan ${countResults} : ${decodeText}`
            }
        }

        // RENDER CAMERA
        var htmlscanner = new Html5QrcodeScanner(
            "my-qr-reader",{fps:10,qrbox:500}   
        )

        htmlscanner.render(onScanSuccess)

    })
</script>
{% endblock %}